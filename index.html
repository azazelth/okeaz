<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>HAEKPAK Player | Compact UI</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Kanit:wght@300;400;600&display=swap" rel="stylesheet">
    <style>
        :root { --neon-cyan: #0ff; }
        body { font-family: 'Kanit', sans-serif; background-color: #000; color: white; min-height: 100vh; overflow: hidden; margin: 0; }
        
        /* ปรับแถบควบคุมให้แคบและเตี้ยลง */
        #bottomControlBar {
            transition: all 0.5s cubic-bezier(0.4, 0, 0.2, 1);
            background: linear-gradient(to top, rgba(0,0,0,0.85) 0%, rgba(0,0,0,0.4) 100%);
            padding-bottom: env(safe-area-inset-bottom);
        }

        .controls-hidden { transform: translateY(100%); opacity: 0; pointer-events: none; }
        #player { pointer-events: none; width: 100%; height: 100%; }
        
        /* เลเยอร์รับสัมผัส */
        #videoOverlay { position: absolute; inset: 0; z-index: 10; }

        .modal-backdrop { position: fixed; inset: 0; background: rgba(0,0,0,0.9); z-index: 9999; display: none; align-items: center; justify-content: center; padding: 1rem; }
        .modal-content { background: #0a0a0c; border: 1px solid rgba(255,255,255,0.1); border-radius: 1.5rem; padding: 1.5rem; width: 100%; max-width: 500px; max-height: 80vh; overflow-y: auto; }
        
        .song-item { display: flex; align-items: center; gap: 0.5rem; padding: 0.5rem; border-radius: 0.5rem; transition: 0.2s; }
    </style>
</head>
<body>

    <div id="searchView" class="min-h-screen p-6 text-center flex flex-col items-center justify-center">
        <h1 class="text-4xl font-black mb-6 italic uppercase">HAEK<span class="text-cyan-400">PAK</span></h1>
        <div class="bg-white/5 p-1 rounded-2xl flex border border-white/10 w-full max-w-sm">
            <input type="text" id="mainSearchInput" placeholder="ค้นหาเพลง..." class="bg-transparent flex-1 px-4 py-2 outline-none text-white">
            <button onclick="mainSearch()" class="bg-cyan-500 text-black px-4 py-2 rounded-xl font-bold">ค้นหา</button>
        </div>
        <div id="mainResultsGrid" class="grid grid-cols-2 gap-3 mt-8 w-full max-w-4xl overflow-y-auto"></div>
    </div>

    <div id="masterContainer" class="hidden fixed inset-0 z-50 flex flex-col bg-black">
        <div class="flex-1 flex overflow-hidden relative">
            <div id="playerWrapper" class="flex-1 flex flex-col bg-black relative">
                <div id="player"></div>
                <div id="videoOverlay" onclick="showControls()"></div>
            </div>

            <aside id="sideQueue" class="hidden md:flex w-64 bg-black/95 border-l border-white/5 flex-col z-20">
                <div class="p-4 border-b border-white/5 flex justify-between items-center text-xs font-bold text-gray-500">
                    <span>NEXT QUEUE</span>
                    <button onclick="toggleSideQueue()" class="text-2xl">&times;</button>
                </div>
                <div id="sideQueueList" class="flex-1 overflow-y-auto p-2 space-y-1"></div>
            </aside>
        </div>

        <div id="bottomControlBar" class="fixed bottom-0 left-0 right-0 z-30 px-4 pb-2 pt-6">
            <div class="max-w-5xl mx-auto">
                <div class="relative h-1 bg-white/20 rounded-full mb-3 cursor-pointer" onclick="seekVideo(event)">
                    <div id="progressBar" class="absolute h-full bg-cyan-400 rounded-full w-0"></div>
                </div>

                <div class="flex items-center justify-between pb-2">
                    <div class="flex items-center gap-3">
                        <button onclick="togglePlay()" class="w-11 h-11 rounded-full bg-cyan-500 flex items-center justify-center shadow-lg active:scale-90 transition">
                            <svg id="playIcon" class="w-5 h-5 text-black ml-0.5" viewBox="0 0 24 24" fill="currentColor"><polygon points="5 3 19 12 5 21 5 3"></polygon></svg>
                            <svg id="pauseIcon" class="hidden w-5 h-5 text-black" viewBox="0 0 24 24" fill="currentColor"><rect x="6" y="4" width="4" height="16"></rect><rect x="14" y="4" width="4" height="16"></rect></svg>
                        </button>
                        <button onclick="skipNext()" class="text-white/60 active:text-white p-2"><svg class="w-6 h-6" viewBox="0 0 24 24" fill="currentColor"><polygon points="5 4 15 12 5 20 5 4"/><rect x="18" y="5" width="2" height="14"/></svg></button>
                    </div>

                    <div class="flex items-center gap-0.5">
                        <button onclick="openModal('searchModal')" class="p-2 text-white/50 active:text-cyan-400"><svg class="w-5 h-5" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="11" cy="11" r="8"/><path d="m21 21-4.35-4.35"/></svg></button>
                        <button onclick="toggleSideQueue()" class="p-2 text-white/50 active:text-cyan-400"><svg class="w-5 h-5" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><line x1="8" y1="6" x2="21" y2="6"></line><line x1="8" y1="12" x2="21" y2="12"></line><line x1="8" y1="18" x2="21" y2="18"></line></svg></button>
                        <button onclick="toggleFullScreen()" class="p-2 text-white/50 active:text-cyan-400"><svg class="w-5 h-5" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M8 3H5a2 2 0 0 0-2 2v3m18 0V5a2 2 0 0 0-2-2h-3m0 18h3a2 2 0 0 0 2-2v-3M3 16v3a2 2 0 0 0 2 2h3"></path></svg></button>
                        
                        <button onclick="forceHideControls()" class="p-2 ml-1 text-cyan-400 active:scale-90 transition">
                            <svg class="w-6 h-6" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5"><path d="M7 13l5 5 5-5M7 6l5 5 5-5"/></svg>
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <div id="searchModal" class="modal-backdrop" onclick="closeModal('searchModal')">
            <div class="modal-content" onclick="event.stopPropagation()">
                <div class="flex justify-between items-center mb-4 text-cyan-400 font-bold">
                    <h3>ค้นหาเพลงเพิ่ม</h3>
                    <button onclick="closeModal('searchModal')" class="text-2xl text-gray-500">&times;</button>
                </div>
                <form onsubmit="modalSearch(event)" class="mb-4">
                    <input type="search" id="modalSearchInput" placeholder="ชื่อเพลง..." class="w-full bg-white/5 border border-white/10 p-3 rounded-xl text-white outline-none focus:border-cyan-500 transition-all">
                </form>
                <div id="modalSearchResults" class="space-y-1"></div>
            </div>
        </div>
    </div>

    <script>
        const API_KEY = 'AIzaSyBS_3Zj3AsSG1y1KQrOWDdE40FLBXROZos';
        let player, queue = [], isStarted = false, controlTimeout;

        const tag = document.createElement('script'); tag.src = "https://www.youtube.com/iframe_api";
        document.getElementsByTagName('head')[0].appendChild(tag);

        function onYouTubeIframeAPIReady() {
            player = new YT.Player('player', {
                playerVars: { 'autoplay': 1, 'controls': 0, 'modestbranding': 1, 'rel': 0, 'disablekb': 1, 'iv_load_policy': 3 },
                events: { 'onStateChange': onPlayerStateChange, 'onReady': () => setInterval(updateProgress, 1000) }
            });
        }

        async function fetchYT(q) {
            const res = await fetch(`https://www.googleapis.com/youtube/v3/search?part=snippet&maxResults=10&q=${encodeURIComponent(q + " คาราโอเกะ")}&type=video&key=${API_KEY}`);
            return await res.json();
        }

        async function mainSearch() {
            const q = document.getElementById('mainSearchInput').value; if(!q) return;
            const data = await fetchYT(q);
            document.getElementById('mainResultsGrid').innerHTML = (data.items || []).map(item => `
                <div onclick="addToQueue('${item.id.videoId}', '${item.snippet.title.replace(/'/g,"")}')" class="bg-white/5 p-2 rounded-lg">
                    <img src="${item.snippet.thumbnails.medium.url}" class="rounded w-full aspect-video object-cover mb-1">
                    <h3 class="text-[10px] text-left line-clamp-1 text-gray-400">${item.snippet.title}</h3>
                </div>`).join('');
        }

        async function modalSearch(e) {
            e.preventDefault();
            const q = document.getElementById('modalSearchInput').value;
            const data = await fetchYT(q);
            document.getElementById('modalSearchResults').innerHTML = (data.items || []).map(item => `
                <div class="song-item" onclick="addToQueue('${item.id.videoId}', '${item.snippet.title.replace(/'/g,"")}')">
                    <div class="flex-1 min-w-0 text-xs truncate">${item.snippet.title}</div>
                    <div class="text-cyan-500 text-[10px] font-bold">+ เพิ่มคิว</div>
                </div>`).join('');
        }

        function addToQueue(id, title) {
            queue.push({id, title}); updateUI();
            if(!isStarted) {
                isStarted = true;
                document.getElementById('searchView').classList.add('hidden');
                document.getElementById('masterContainer').classList.remove('hidden');
                playNext();
            }
            closeModal('searchModal');
            showControls();
        }

        function playNext() {
            if(queue.length > 0) {
                player.loadVideoById(queue[0].id);
                updateUI();
            } else { location.reload(); }
        }

        function onPlayerStateChange(e) {
            if(e.data === 1) { document.getElementById('playIcon').classList.add('hidden'); document.getElementById('pauseIcon').classList.remove('hidden'); }
            else { document.getElementById('playIcon').classList.remove('hidden'); document.getElementById('pauseIcon').classList.add('hidden'); }
            if(e.data === 0) { queue.shift(); playNext(); }
        }

        function updateProgress() {
            if(player && player.getDuration) {
                const cur = player.getCurrentTime(), dur = player.getDuration();
                if(dur > 0) document.getElementById('progressBar').style.width = (cur/dur)*100+'%';
            }
        }

        function showControls() {
            const bar = document.getElementById('bottomControlBar');
            bar.classList.remove('controls-hidden');
            clearTimeout(controlTimeout);
            controlTimeout = setTimeout(() => {
                if(isStarted && document.getElementById('searchModal').style.display !== 'flex') {
                    bar.classList.add('controls-hidden');
                }
            }, 4000); 
        }

        function forceHideControls() { document.getElementById('bottomControlBar').classList.add('controls-hidden'); }
        function toggleSideQueue() {
            const side = document.getElementById('sideQueue');
            side.style.display = (side.style.display === 'none' || side.classList.contains('hidden')) ? 'flex' : 'none';
            side.classList.remove('hidden');
            showControls();
        }

        function toggleFullScreen() {
            const el = document.getElementById('masterContainer');
            if (!document.fullscreenElement) {
                if(el.requestFullscreen) el.requestFullscreen();
                else if(el.webkitRequestFullscreen) el.webkitRequestFullscreen();
            } else {
                if(document.exitFullscreen) document.exitFullscreen();
            }
            showControls();
        }

        function togglePlay() { 
            player.getPlayerState() === 1 ? player.pauseVideo() : player.playVideo();
            showControls(); 
        }

        function skipNext() { queue.shift(); playNext(); showControls(); }
        function openModal(id) { document.getElementById(id).style.display = 'flex'; }
        function closeModal(id) { document.getElementById(id).style.display = 'none'; showControls(); }
        
        function seekVideo(e) { 
            const rect = e.currentTarget.getBoundingClientRect(); 
            const x = e.clientX || (e.touches ? e.touches[0].clientX : 0);
            player.seekTo(((x - rect.left) / rect.width) * player.getDuration(), true);
            showControls();
        }

        function updateUI() {
            const side = document.getElementById('sideQueueList');
            side.innerHTML = queue.length ? queue.map((s,i) => `
                <div class="song-item ${i===0?'bg-cyan-500/10 border border-cyan-500/20':'opacity-60'}">
                    <div class="flex-1 min-w-0 text-[10px] truncate ${i===0?'text-cyan-400 font-bold':''}">${s.title}</div>
                    <div class="flex gap-1">
                        ${i !== 0 ? `<button onclick="playThisNow(${i})" class="bg-cyan-500 text-black px-1.5 py-0.5 rounded text-[9px] font-bold">เล่น</button>` : ''}
                        <button onclick="removeFromQueue(${i})" class="text-lg text-gray-500">&times;</button>
                    </div>
                </div>`).join('') : '';
        }

        function playThisNow(index) {
            const song = queue.splice(index, 1)[0];
            queue.unshift(song);
            playNext();
        }

        function removeFromQueue(i) { queue.splice(i,1); updateUI(); }
        document.getElementById('mainSearchInput').onkeypress = (e) => { if(e.key==='Enter') mainSearch(); }
    </script>
</body>
</html>
<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>HAEKPAK Player | Compact UI</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Kanit:wght@300;400;600&display=swap" rel="stylesheet">
    <style>
        :root { --neon-cyan: #0ff; }
        body { font-family: 'Kanit', sans-serif; background-color: #000; color: white; min-height: 100vh; overflow: hidden; margin: 0; }
        
        /* ปรับแถบควบคุมให้แคบและเตี้ยลง */
        #bottomControlBar {
            transition: all 0.5s cubic-bezier(0.4, 0, 0.2, 1);
            background: linear-gradient(to top, rgba(0,0,0,0.85) 0%, rgba(0,0,0,0.4) 100%);
            padding-bottom: env(safe-area-inset-bottom);
        }

        .controls-hidden { transform: translateY(100%); opacity: 0; pointer-events: none; }
        #player { pointer-events: none; width: 100%; height: 100%; }
        
        /* เลเยอร์รับสัมผัส */
        #videoOverlay { position: absolute; inset: 0; z-index: 10; }

        .modal-backdrop { position: fixed; inset: 0; background: rgba(0,0,0,0.9); z-index: 9999; display: none; align-items: center; justify-content: center; padding: 1rem; }
        .modal-content { background: #0a0a0c; border: 1px solid rgba(255,255,255,0.1); border-radius: 1.5rem; padding: 1.5rem; width: 100%; max-width: 500px; max-height: 80vh; overflow-y: auto; }
        
        .song-item { display: flex; align-items: center; gap: 0.5rem; padding: 0.5rem; border-radius: 0.5rem; transition: 0.2s; }
    </style>
</head>
<body>

    <div id="searchView" class="min-h-screen p-6 text-center flex flex-col items-center justify-center">
        <h1 class="text-4xl font-black mb-6 italic uppercase">HAEK<span class="text-cyan-400">PAK</span></h1>
        <div class="bg-white/5 p-1 rounded-2xl flex border border-white/10 w-full max-w-sm">
            <input type="text" id="mainSearchInput" placeholder="ค้นหาเพลง..." class="bg-transparent flex-1 px-4 py-2 outline-none text-white">
            <button onclick="mainSearch()" class="bg-cyan-500 text-black px-4 py-2 rounded-xl font-bold">ค้นหา</button>
        </div>
        <div id="mainResultsGrid" class="grid grid-cols-2 gap-3 mt-8 w-full max-w-4xl overflow-y-auto"></div>
    </div>

    <div id="masterContainer" class="hidden fixed inset-0 z-50 flex flex-col bg-black">
        <div class="flex-1 flex overflow-hidden relative">
            <div id="playerWrapper" class="flex-1 flex flex-col bg-black relative">
                <div id="player"></div>
                <div id="videoOverlay" onclick="showControls()"></div>
            </div>

            <aside id="sideQueue" class="hidden md:flex w-64 bg-black/95 border-l border-white/5 flex-col z-20">
                <div class="p-4 border-b border-white/5 flex justify-between items-center text-xs font-bold text-gray-500">
                    <span>NEXT QUEUE</span>
                    <button onclick="toggleSideQueue()" class="text-2xl">&times;</button>
                </div>
                <div id="sideQueueList" class="flex-1 overflow-y-auto p-2 space-y-1"></div>
            </aside>
        </div>

        <div id="bottomControlBar" class="fixed bottom-0 left-0 right-0 z-30 px-4 pb-2 pt-6">
            <div class="max-w-5xl mx-auto">
                <div class="relative h-1 bg-white/20 rounded-full mb-3 cursor-pointer" onclick="seekVideo(event)">
                    <div id="progressBar" class="absolute h-full bg-cyan-400 rounded-full w-0"></div>
                </div>

                <div class="flex items-center justify-between pb-2">
                    <div class="flex items-center gap-3">
                        <button onclick="togglePlay()" class="w-11 h-11 rounded-full bg-cyan-500 flex items-center justify-center shadow-lg active:scale-90 transition">
                            <svg id="playIcon" class="w-5 h-5 text-black ml-0.5" viewBox="0 0 24 24" fill="currentColor"><polygon points="5 3 19 12 5 21 5 3"></polygon></svg>
                            <svg id="pauseIcon" class="hidden w-5 h-5 text-black" viewBox="0 0 24 24" fill="currentColor"><rect x="6" y="4" width="4" height="16"></rect><rect x="14" y="4" width="4" height="16"></rect></svg>
                        </button>
                        <button onclick="skipNext()" class="text-white/60 active:text-white p-2"><svg class="w-6 h-6" viewBox="0 0 24 24" fill="currentColor"><polygon points="5 4 15 12 5 20 5 4"/><rect x="18" y="5" width="2" height="14"/></svg></button>
                    </div>

                    <div class="flex items-center gap-0.5">
                        <button onclick="openModal('searchModal')" class="p-2 text-white/50 active:text-cyan-400"><svg class="w-5 h-5" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="11" cy="11" r="8"/><path d="m21 21-4.35-4.35"/></svg></button>
                        <button onclick="toggleSideQueue()" class="p-2 text-white/50 active:text-cyan-400"><svg class="w-5 h-5" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><line x1="8" y1="6" x2="21" y2="6"></line><line x1="8" y1="12" x2="21" y2="12"></line><line x1="8" y1="18" x2="21" y2="18"></line></svg></button>
                        <button onclick="toggleFullScreen()" class="p-2 text-white/50 active:text-cyan-400"><svg class="w-5 h-5" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M8 3H5a2 2 0 0 0-2 2v3m18 0V5a2 2 0 0 0-2-2h-3m0 18h3a2 2 0 0 0 2-2v-3M3 16v3a2 2 0 0 0 2 2h3"></path></svg></button>
                        
                        <button onclick="forceHideControls()" class="p-2 ml-1 text-cyan-400 active:scale-90 transition">
                            <svg class="w-6 h-6" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5"><path d="M7 13l5 5 5-5M7 6l5 5 5-5"/></svg>
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <div id="searchModal" class="modal-backdrop" onclick="closeModal('searchModal')">
            <div class="modal-content" onclick="event.stopPropagation()">
                <div class="flex justify-between items-center mb-4 text-cyan-400 font-bold">
                    <h3>ค้นหาเพลงเพิ่ม</h3>
                    <button onclick="closeModal('searchModal')" class="text-2xl text-gray-500">&times;</button>
                </div>
                <form onsubmit="modalSearch(event)" class="mb-4">
                    <input type="search" id="modalSearchInput" placeholder="ชื่อเพลง..." class="w-full bg-white/5 border border-white/10 p-3 rounded-xl text-white outline-none focus:border-cyan-500 transition-all">
                </form>
                <div id="modalSearchResults" class="space-y-1"></div>
            </div>
        </div>
    </div>

    <script>
        const API_KEY = 'AIzaSyBS_3Zj3AsSG1y1KQrOWDdE40FLBXROZos';
        let player, queue = [], isStarted = false, controlTimeout;

        const tag = document.createElement('script'); tag.src = "https://www.youtube.com/iframe_api";
        document.getElementsByTagName('head')[0].appendChild(tag);

        function onYouTubeIframeAPIReady() {
            player = new YT.Player('player', {
                playerVars: { 'autoplay': 1, 'controls': 0, 'modestbranding': 1, 'rel': 0, 'disablekb': 1, 'iv_load_policy': 3 },
                events: { 'onStateChange': onPlayerStateChange, 'onReady': () => setInterval(updateProgress, 1000) }
            });
        }

        async function fetchYT(q) {
            const res = await fetch(`https://www.googleapis.com/youtube/v3/search?part=snippet&maxResults=10&q=${encodeURIComponent(q + " คาราโอเกะ")}&type=video&key=${API_KEY}`);
            return await res.json();
        }

        async function mainSearch() {
            const q = document.getElementById('mainSearchInput').value; if(!q) return;
            const data = await fetchYT(q);
            document.getElementById('mainResultsGrid').innerHTML = (data.items || []).map(item => `
                <div onclick="addToQueue('${item.id.videoId}', '${item.snippet.title.replace(/'/g,"")}')" class="bg-white/5 p-2 rounded-lg">
                    <img src="${item.snippet.thumbnails.medium.url}" class="rounded w-full aspect-video object-cover mb-1">
                    <h3 class="text-[10px] text-left line-clamp-1 text-gray-400">${item.snippet.title}</h3>
                </div>`).join('');
        }

        async function modalSearch(e) {
            e.preventDefault();
            const q = document.getElementById('modalSearchInput').value;
            const data = await fetchYT(q);
            document.getElementById('modalSearchResults').innerHTML = (data.items || []).map(item => `
                <div class="song-item" onclick="addToQueue('${item.id.videoId}', '${item.snippet.title.replace(/'/g,"")}')">
                    <div class="flex-1 min-w-0 text-xs truncate">${item.snippet.title}</div>
                    <div class="text-cyan-500 text-[10px] font-bold">+ เพิ่มคิว</div>
                </div>`).join('');
        }

        function addToQueue(id, title) {
            queue.push({id, title}); updateUI();
            if(!isStarted) {
                isStarted = true;
                document.getElementById('searchView').classList.add('hidden');
                document.getElementById('masterContainer').classList.remove('hidden');
                playNext();
            }
            closeModal('searchModal');
            showControls();
        }

        function playNext() {
            if(queue.length > 0) {
                player.loadVideoById(queue[0].id);
                updateUI();
            } else { location.reload(); }
        }

        function onPlayerStateChange(e) {
            if(e.data === 1) { document.getElementById('playIcon').classList.add('hidden'); document.getElementById('pauseIcon').classList.remove('hidden'); }
            else { document.getElementById('playIcon').classList.remove('hidden'); document.getElementById('pauseIcon').classList.add('hidden'); }
            if(e.data === 0) { queue.shift(); playNext(); }
        }

        function updateProgress() {
            if(player && player.getDuration) {
                const cur = player.getCurrentTime(), dur = player.getDuration();
                if(dur > 0) document.getElementById('progressBar').style.width = (cur/dur)*100+'%';
            }
        }

        function showControls() {
            const bar = document.getElementById('bottomControlBar');
            bar.classList.remove('controls-hidden');
            clearTimeout(controlTimeout);
            controlTimeout = setTimeout(() => {
                if(isStarted && document.getElementById('searchModal').style.display !== 'flex') {
                    bar.classList.add('controls-hidden');
                }
            }, 4000); 
        }

        function forceHideControls() { document.getElementById('bottomControlBar').classList.add('controls-hidden'); }
        function toggleSideQueue() {
            const side = document.getElementById('sideQueue');
            side.style.display = (side.style.display === 'none' || side.classList.contains('hidden')) ? 'flex' : 'none';
            side.classList.remove('hidden');
            showControls();
        }

        function toggleFullScreen() {
            const el = document.getElementById('masterContainer');
            if (!document.fullscreenElement) {
                if(el.requestFullscreen) el.requestFullscreen();
                else if(el.webkitRequestFullscreen) el.webkitRequestFullscreen();
            } else {
                if(document.exitFullscreen) document.exitFullscreen();
            }
            showControls();
        }

        function togglePlay() { 
            player.getPlayerState() === 1 ? player.pauseVideo() : player.playVideo();
            showControls(); 
        }

        function skipNext() { queue.shift(); playNext(); showControls(); }
        function openModal(id) { document.getElementById(id).style.display = 'flex'; }
        function closeModal(id) { document.getElementById(id).style.display = 'none'; showControls(); }
        
        function seekVideo(e) { 
            const rect = e.currentTarget.getBoundingClientRect(); 
            const x = e.clientX || (e.touches ? e.touches[0].clientX : 0);
            player.seekTo(((x - rect.left) / rect.width) * player.getDuration(), true);
            showControls();
        }

        function updateUI() {
            const side = document.getElementById('sideQueueList');
            side.innerHTML = queue.length ? queue.map((s,i) => `
                <div class="song-item ${i===0?'bg-cyan-500/10 border border-cyan-500/20':'opacity-60'}">
                    <div class="flex-1 min-w-0 text-[10px] truncate ${i===0?'text-cyan-400 font-bold':''}">${s.title}</div>
                    <div class="flex gap-1">
                        ${i !== 0 ? `<button onclick="playThisNow(${i})" class="bg-cyan-500 text-black px-1.5 py-0.5 rounded text-[9px] font-bold">เล่น</button>` : ''}
                        <button onclick="removeFromQueue(${i})" class="text-lg text-gray-500">&times;</button>
                    </div>
                </div>`).join('') : '';
        }

        function playThisNow(index) {
            const song = queue.splice(index, 1)[0];
            queue.unshift(song);
            playNext();
        }

        function removeFromQueue(i) { queue.splice(i,1); updateUI(); }
        document.getElementById('mainSearchInput').onkeypress = (e) => { if(e.key==='Enter') mainSearch(); }
    </script>
</body>
</html>

